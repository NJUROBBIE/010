<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API测试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="container mt-5">
    <h1 class="mb-4">演唱会抢票系统 - API测试</h1>
    
    <div class="card mb-4">
        <div class="card-header">获取演唱会列表</div>
        <div class="card-body">
            <button id="getConcerts" class="btn btn-primary mb-3">获取演唱会</button>
            <pre id="concertsResult" class="bg-light p-3 rounded"></pre>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">用户注册</div>
        <div class="card-body">
            <form id="registerForm">
                <div class="mb-3">
                    <label for="username" class="form-label">用户名</label>
                    <input type="text" class="form-control" id="username" name="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">密码</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                </div>
                <div class="mb-3">
                    <label for="phone_number" class="form-label">手机号</label>
                    <input type="text" class="form-control" id="phone_number" name="phone_number">
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">邮箱</label>
                    <input type="email" class="form-control" id="email" name="email">
                </div>
                <button type="submit" class="btn btn-primary">注册</button>
            </form>
            <pre id="registerResult" class="bg-light p-3 rounded mt-3"></pre>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">用户登录</div>
        <div class="card-body">
            <form id="loginForm">
                <div class="mb-3">
                    <label for="loginUsername" class="form-label">用户名</label>
                    <input type="text" class="form-control" id="loginUsername" name="username" required>
                </div>
                <div class="mb-3">
                    <label for="loginPassword" class="form-label">密码</label>
                    <input type="password" class="form-control" id="loginPassword" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">登录</button>
            </form>
            <pre id="loginResult" class="bg-light p-3 rounded mt-3"></pre>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">获取演唱会详情</div>
        <div class="card-body">
            <div class="mb-3">
                <label for="concertId" class="form-label">演唱会ID</label>
                <input type="number" class="form-control" id="concertId" placeholder="输入演唱会ID">
            </div>
            <button id="getConcertDetail" class="btn btn-primary mb-3">获取详情</button>
            <pre id="concertDetailResult" class="bg-light p-3 rounded"></pre>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">获取场次票档信息</div>
        <div class="card-body">
            <div class="mb-3">
                <label for="eventId" class="form-label">场次ID</label>
                <input type="number" class="form-control" id="eventId" placeholder="输入场次ID">
            </div>
            <button id="getEventTickets" class="btn btn-primary mb-3">获取票档</button>
            <pre id="eventTicketsResult" class="bg-light p-3 rounded"></pre>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">抢票功能</div>
        <div class="card-body">
            <form id="rushTicketForm">
                <div class="mb-3">
                    <label for="rushUserId" class="form-label">用户ID</label>
                    <input type="number" class="form-control" id="rushUserId" name="user_id" required>
                </div>
                <div class="mb-3">
                    <label for="rushEventId" class="form-label">场次ID</label>
                    <input type="number" class="form-control" id="rushEventId" name="event_id" required>
                </div>
                <div class="mb-3">
                    <label for="rushTicketId" class="form-label">票档ID</label>
                    <input type="number" class="form-control" id="rushTicketId" name="ticket_id" required>
                </div>
                <button type="submit" class="btn btn-primary">抢票</button>
            </form>
            <pre id="rushTicketResult" class="bg-light p-3 rounded mt-3"></pre>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">获取用户订单</div>
        <div class="card-body">
            <div class="mb-3">
                <label for="ordersUserId" class="form-label">用户ID</label>
                <input type="number" class="form-control" id="ordersUserId" placeholder="输入用户ID">
            </div>
            <button id="getUserOrders" class="btn btn-primary mb-3">获取订单</button>
            <pre id="userOrdersResult" class="bg-light p-3 rounded"></pre>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">收藏/取消收藏演唱会</div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="favoriteUserId" class="form-label">用户ID</label>
                    <input type="number" class="form-control" id="favoriteUserId" placeholder="输入用户ID">
                </div>
                <div class="col-md-4">
                    <label for="favoriteConcertId" class="form-label">演唱会ID</label>
                    <input type="number" class="form-control" id="favoriteConcertId" placeholder="输入演唱会ID">
                </div>
            </div>
            <div class="mb-3">
                <button id="favoriteConcert" class="btn btn-primary me-2">收藏</button>
                <button id="unfavoriteConcert" class="btn btn-secondary me-2">取消收藏</button>
                <button id="getUserFavorites" class="btn btn-info">获取收藏列表</button>
            </div>
            <pre id="favoriteResult" class="bg-light p-3 rounded"></pre>
        </div>
    </div>

    <script>
        // 获取演唱会列表
        document.getElementById('getConcerts').addEventListener('click', async function() {
            try {
                const response = await fetch('http://127.0.0.1:5000/api/concerts');
                const data = await response.json();
                document.getElementById('concertsResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('concertsResult').textContent = '错误: ' + error.message;
            }
        });

        // 用户注册
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const userData = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                const data = await response.json();
                document.getElementById('registerResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('registerResult').textContent = '错误: ' + error.message;
            }
        });

        // 用户登录
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const userData = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                const data = await response.json();
                document.getElementById('loginResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('loginResult').textContent = '错误: ' + error.message;
            }
        });

        // 获取演唱会详情
        document.getElementById('getConcertDetail').addEventListener('click', async function() {
            const concertId = document.getElementById('concertId').value;
            if (!concertId) {
                document.getElementById('concertDetailResult').textContent = '请输入演唱会ID';
                return;
            }
            
            try {
                const response = await fetch(`http://127.0.0.1:5000/api/concerts/${concertId}`);
                const data = await response.json();
                document.getElementById('concertDetailResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('concertDetailResult').textContent = '错误: ' + error.message;
            }
        });

        // 获取场次票档信息
        document.getElementById('getEventTickets').addEventListener('click', async function() {
            const eventId = document.getElementById('eventId').value;
            if (!eventId) {
                document.getElementById('eventTicketsResult').textContent = '请输入场次ID';
                return;
            }
            
            try {
                const response = await fetch(`http://127.0.0.1:5000/api/events/${eventId}/tickets`);
                const data = await response.json();
                document.getElementById('eventTicketsResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('eventTicketsResult').textContent = '错误: ' + error.message;
            }
        });

        // 抢票功能
        document.getElementById('rushTicketForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const rushData = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/rush_ticket', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(rushData)
                });
                const data = await response.json();
                document.getElementById('rushTicketResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('rushTicketResult').textContent = '错误: ' + error.message;
            }
        });

        // 获取用户订单
        document.getElementById('getUserOrders').addEventListener('click', async function() {
            const userId = document.getElementById('ordersUserId').value;
            if (!userId) {
                document.getElementById('userOrdersResult').textContent = '请输入用户ID';
                return;
            }
            
            try {
                const response = await fetch(`http://127.0.0.1:5000/api/users/${userId}/orders`);
                const data = await response.json();
                document.getElementById('userOrdersResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('userOrdersResult').textContent = '错误: ' + error.message;
            }
        });

        // 收藏演唱会
        document.getElementById('favoriteConcert').addEventListener('click', async function() {
            const userId = document.getElementById('favoriteUserId').value;
            const concertId = document.getElementById('favoriteConcertId').value;
            if (!userId || !concertId) {
                document.getElementById('favoriteResult').textContent = '请输入用户ID和演唱会ID';
                return;
            }
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/favorite_concert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: userId, concert_id: concertId })
                });
                const data = await response.json();
                document.getElementById('favoriteResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('favoriteResult').textContent = '错误: ' + error.message;
            }
        });

        // 取消收藏演唱会
        document.getElementById('unfavoriteConcert').addEventListener('click', async function() {
            const userId = document.getElementById('favoriteUserId').value;
            const concertId = document.getElementById('favoriteConcertId').value;
            if (!userId || !concertId) {
                document.getElementById('favoriteResult').textContent = '请输入用户ID和演唱会ID';
                return;
            }
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/unfavorite_concert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: userId, concert_id: concertId })
                });
                const data = await response.json();
                document.getElementById('favoriteResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('favoriteResult').textContent = '错误: ' + error.message;
            }
        });

        // 获取用户收藏列表
        document.getElementById('getUserFavorites').addEventListener('click', async function() {
            const userId = document.getElementById('favoriteUserId').value;
            if (!userId) {
                document.getElementById('favoriteResult').textContent = '请输入用户ID';
                return;
            }
            
            try {
                const response = await fetch(`http://127.0.0.1:5000/api/users/${userId}/favorites`);
                const data = await response.json();
                document.getElementById('favoriteResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('favoriteResult').textContent = '错误: ' + error.message;
            }
        });
    </script>
</body>
</html>